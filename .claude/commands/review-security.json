{
  "name": "review-security",
  "description": "Perform security-focused code review following security best practices",
  "agent": "security_agent",
  "workflow": "security_workflow",
  "contexts": [
    "security_context",
    "test_status"
  ],
  "parameters": {
    "module": {
      "type": "string",
      "description": "Module to review (crypto, network, dag, protocol)",
      "required": true,
      "enum": ["crypto", "network", "dag", "protocol"]
    },
    "file_pattern": {
      "type": "string",
      "description": "Optional file pattern to focus review (e.g., '**/*.rs')",
      "required": false
    },
    "checklist": {
      "type": "array",
      "description": "Custom security checklist items to verify",
      "required": false,
      "items": {
        "type": "string"
      }
    }
  },
  "prompts": {
    "review_process": "Conduct thorough security review:
1. Code Analysis: Review for unsafe blocks, error handling, input validation
2. Crypto Review: Check for timing attacks, proper key handling, secure RNG usage
3. Memory Safety: Verify proper cleanup, no leaks, bounds checking
4. Trust Boundaries: Identify and validate all trust boundaries
5. Attack Vectors: Consider potential attack scenarios",
    "checklist_validation": "Verify against security checklist:
- [ ] No unsafe code without justification
- [ ] All errors properly handled
- [ ] Input validation on all external data
- [ ] Constant-time crypto operations
- [ ] Secure random number generation
- [ ] Memory zeroization for secrets
- [ ] No debug prints of sensitive data
- [ ] Proper access controls
- [ ] Rate limiting where appropriate
- [ ] Audit logging for security events",
    "risk_assessment": "Assess security risks:
1. Identify potential vulnerabilities
2. Evaluate likelihood and impact
3. Prioritize by risk score
4. Recommend mitigations
5. Consider defense in depth"
  },
  "examples": [
    "/review-security crypto",
    "/review-security network --file_pattern 'src/transport.rs'",
    "/review-security protocol --checklist 'Check message authentication','Verify replay protection'"
  ],
  "output": {
    "success": {
      "format": "markdown",
      "sections": [
        "## Security Review Summary",
        "### Module: {module}",
        "### Review Date: {date}",
        "### Reviewer: Security Agent",
        "## 1. Security Analysis",
        "### 1.1 Code Quality",
        "### 1.2 Security Patterns",
        "### 1.3 Anti-Patterns Found",
        "## 2. Vulnerability Assessment",
        "### 2.1 Identified Vulnerabilities",
        "### 2.2 Risk Ratings",
        "### 2.3 Attack Scenarios",
        "## 3. Best Practices Review",
        "### 3.1 Compliance Status",
        "### 3.2 Security Controls",
        "### 3.3 Missing Controls",
        "## 4. Risk Assessment",
        "### 4.1 Risk Matrix",
        "### 4.2 Impact Analysis",
        "### 4.3 Mitigation Priority",
        "## 5. Recommendations",
        "### 5.1 Immediate Actions",
        "### 5.2 Short-term Improvements",
        "### 5.3 Long-term Enhancements",
        "## Appendix: Code Examples"
      ],
      "artifacts": [
        "security_review_{module}.md",
        "vulnerability_report_{module}.json",
        "risk_matrix_{module}.csv"
      ]
    },
    "checklist_results": {
      "passed": "array of passed checks",
      "failed": "array of failed checks",
      "warnings": "array of warning items",
      "not_applicable": "array of N/A items"
    }
  },
  "error_handling": {
    "invalid_module": {
      "message": "Invalid module: {module}",
      "recovery": "Valid modules: crypto, network, dag, protocol"
    },
    "scan_failure": {
      "message": "Security scan failed: {error}",
      "recovery": "Check module exists and retry with --verbose"
    },
    "high_risk_finding": {
      "message": "HIGH RISK: Critical security issue found in {location}",
      "recovery": "Stop deployment. Apply remediation immediately.",
      "escalation": "Notify security team and project lead"
    }
  },
  "post_actions": [
    "Update security_context.json with review results",
    "Create issues for findings",
    "Update security documentation",
    "Schedule follow-up review if needed"
  ]
}