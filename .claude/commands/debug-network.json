{
  "name": "debug-network",
  "description": "Diagnose networking issues including P2P connectivity, routing, and dark addressing",
  "agent": "agents/network_agent.md",
  "contexts": [
    "contexts/performance_context.md",
    "contexts/test_status.md"
  ],
  "parameters": {
    "node": {
      "type": "string",
      "description": "Optional node ID or dark address to debug",
      "required": false
    },
    "component": {
      "type": "string",
      "description": "Specific network component to debug",
      "required": false,
      "options": [
        "p2p",
        "routing",
        "dark_addressing",
        "onion",
        "transport",
        "discovery",
        "all"
      ],
      "default": "all"
    },
    "verbose": {
      "type": "boolean",
      "description": "Enable verbose logging",
      "required": false,
      "default": false
    },
    "trace": {
      "type": "boolean",
      "description": "Enable message tracing",
      "required": false,
      "default": false
    }
  },
  "examples": [
    "/debug-network",
    "/debug-network --node node-123",
    "/debug-network --component routing --verbose",
    "/debug-network --node dark:7f3a9b2c --trace",
    "/debug-network --component dark_addressing",
    "/debug-network --component onion --verbose"
  ],
  "diagnostic_checks": {
    "p2p": [
      "peer_connections",
      "handshake_status",
      "connection_health",
      "bandwidth_usage"
    ],
    "routing": [
      "routing_table",
      "path_diversity",
      "route_convergence",
      "dead_routes"
    ],
    "dark_addressing": [
      "address_resolution",
      "dark_pool_status",
      "anonymity_metrics",
      "lookup_performance"
    ],
    "onion": [
      "layer_construction",
      "circuit_health",
      "relay_performance",
      "anonymity_preservation"
    ],
    "transport": [
      "protocol_stats",
      "encryption_status",
      "compression_ratio",
      "error_rates"
    ]
  },
  "output": {
    "success": "Comprehensive network diagnostic report",
    "format": [
      "1. Network Overview",
      "   - Node ID: {node_id}",
      "   - Dark Address: {dark_address}",
      "   - Uptime: {uptime}",
      "   - Network Status: {status}",
      "2. P2P Connectivity",
      "   - Active Peers: {peer_count}",
      "   - Connection Health: {connection_metrics}",
      "   - Bandwidth: In: {bandwidth_in}, Out: {bandwidth_out}",
      "   - Failed Connections: {failed_connections}",
      "3. Routing Analysis",
      "   - Routing Table Size: {route_count}",
      "   - Path Diversity: {path_diversity_score}",
      "   - Average Hop Count: {avg_hops}",
      "   - Routing Failures: {routing_failures}",
      "4. Dark Addressing System",
      "   - Active Dark Addresses: {dark_address_count}",
      "   - Resolution Success Rate: {resolution_rate}%",
      "   - Anonymity Set Size: {anonymity_set}",
      "   - Lookup Latency: {lookup_latency}ms",
      "5. Onion Routing",
      "   - Active Circuits: {circuit_count}",
      "   - Layer Count: {onion_layers}",
      "   - Circuit Build Time: {circuit_build_time}ms",
      "   - Relay Performance: {relay_metrics}",
      "6. Performance Metrics",
      "   - Message Throughput: {messages_per_second}",
      "   - Average Latency: {avg_latency}ms",
      "   - Memory Usage: {memory_usage}MB",
      "   - CPU Usage: {cpu_usage}%",
      "7. Error Analysis",
      "   - Recent Errors: {error_summary}",
      "   - Error Rate: {error_rate}",
      "   - Critical Issues: {critical_issues}",
      "8. Security Status",
      "   - Encryption: {encryption_status}",
      "   - Authentication: {auth_status}",
      "   - Anomalies Detected: {anomaly_count}",
      "9. Recommendations",
      "   - Performance: {performance_suggestions}",
      "   - Security: {security_recommendations}",
      "   - Configuration: {config_improvements}"
    ]
  },
  "performance_thresholds": {
    "latency_warning": "100ms",
    "latency_critical": "1000ms",
    "peer_count_min": 3,
    "bandwidth_min": "1MB/s",
    "error_rate_max": "0.01"
  },
  "error_handling": {
    "node_offline": "Node is offline or unreachable",
    "invalid_node": "Invalid node ID or dark address format",
    "network_error": "Network diagnostic failure: {error}",
    "component_error": "Failed to diagnose {component}: {error}",
    "permission_denied": "Insufficient permissions to access network diagnostics"
  },
  "related_commands": [
    "/network-simulate",
    "/performance-benchmark network",
    "/security-audit network",
    "/tdd-cycle network"
  ]
}